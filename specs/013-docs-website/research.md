# Research: Documentation Website

**Feature**: 013-docs-website  
**Date**: 2026-02-09  
**Status**: Complete

## Research Tasks

### 1. Docusaurus v3 Project Scaffolding with External Docs Directory

**Decision**: Use `create-docusaurus` to scaffold in `/website`, then configure `docs.path` to point to `../docs` at repo root.

**Rationale**: Docusaurus's classic preset natively supports an external docs path via the `path` field in the docs plugin config. This keeps the Docusaurus tooling (config, themes, static assets, node_modules) isolated in `/website` while documentation Markdown lives at the repo root in `/docs`, making docs editable without navigating the site tooling.

**Alternatives considered**:
- **Monorepo with symlinks**: Unnecessarily complex; Docusaurus already supports relative paths natively.
- **Docs inside /website**: Would mix content with tooling; harder for documentation-only contributors to navigate.
- **Monorepo tool (Turborepo/Nx)**: Over-engineered for a single Docusaurus project with an external docs path.

**Key configuration**:
```typescript
// docusaurus.config.ts (inside /website)
docs: {
  path: '../docs',
  sidebarPath: './sidebars.ts',
}
```

### 2. GitHub Pages Deployment Strategy

**Decision**: Use the `actions/deploy-pages@v4` workflow (not `peaceiris/actions-gh-pages` or `docusaurus deploy` CLI) with GitHub's native Pages artifact upload via `actions/upload-pages-artifact@v3`.

**Rationale**: This is the current recommended approach from both Docusaurus official docs (v3.8+) and GitHub. It deploys from a workflow artifact rather than a branch, avoids the need for a `gh-pages` branch, and uses GitHub's native environment protection for deployments. The design notes already specify this approach.

**Alternatives considered**:
- **`peaceiris/actions-gh-pages`**: Older approach that deploys to a `gh-pages` branch; requires `contents: write` permission. The artifact-based approach is cleaner.
- **`docusaurus deploy` CLI**: Requires SSH key or token configuration; less transparent than a workflow file.
- **Manual deployment from a branch**: No automation; violates FR-007.

**Key details**:
- `working-directory: ./website` for all build steps.
- `path: website/build` for the upload artifact step (relative to checkout root).
- Path filtering on `docs/**` and `website/**` plus `workflow_dispatch`.
- `concurrency.group: pages` with `cancel-in-progress: true` to avoid parallel deploys.

### 3. Mermaid Diagram Support

**Decision**: Use `@docusaurus/theme-mermaid` (first-party Docusaurus plugin) with `markdown.mermaid: true` in config.

**Rationale**: This is the officially supported Mermaid integration for Docusaurus v3. It renders diagrams client-side from fenced `mermaid` code blocks. No build-time rendering needed; diagrams are interactive SVGs in the browser.

**Alternatives considered**:
- **`remark-mermaid`**: Third-party, renders at build time to static images; loses interactivity and dark-mode adaptation.
- **`mermaid-js` manual integration**: Requires custom MDX components; more work for the same result.

**Key configuration**:
```typescript
markdown: { mermaid: true },
themes: ['@docusaurus/theme-mermaid'],
```

### 4. Sidebar Organization Strategy

**Decision**: Use autogenerated sidebars per section with `_category_.json` files in each docs subdirectory to control labels and ordering.

**Rationale**: Autogenerated sidebars reduce manual maintenance — adding a new doc page to a directory automatically adds it to the sidebar. `_category_.json` files provide explicit control over section labels, descriptions, and sort order. This scales well as content grows.

**Alternatives considered**:
- **Fully manual `sidebars.ts`**: Requires updating the sidebar config file every time a doc is added/moved. Tedious for content-focused contributors.
- **Fully autogenerated without `_category_.json`**: Ordering becomes unpredictable; section labels default to directory names.

**Sidebar structure**:
```typescript
// sidebars.ts
const sidebars = {
  docs: [{ type: 'autogenerated', dirName: '.' }],
};
export default sidebars;
```

Each docs subdirectory gets a `_category_.json`:
```json
{ "label": "Getting Started", "position": 1 }
```

### 5. Custom Theme and Dark Mode Implementation

**Decision**: Use Docusaurus built-in Infima CSS variables for theming. Override `--ifm-color-primary-*` in `custom.css` for both light and dark modes via the `[data-theme="dark"]` selector. Set dark mode as default with `respectPrefersColorScheme: true`.

**Rationale**: Docusaurus's Infima framework already provides a complete CSS variable system for theming. Overriding these variables is the recommended and most maintainable approach — it integrates with the existing color mode toggle and requires no custom JavaScript.

**Alternatives considered**:
- **Custom theme component swizzling**: Overkill for color changes; introduces maintenance burden on Docusaurus upgrades.
- **Tailwind CSS**: Would conflict with Infima's CSS framework and create inconsistencies.

### 6. Content Migration from README.md

**Decision**: Extract content from `README.md` into structured docs pages, reorganized by section. The README will be simplified to a brief project description with a link to the documentation site.

**Rationale**: The README contains installation, configuration reference, CLI commands, and project structure — all of which map directly to the docs site sections. Duplicating content across README and docs creates drift; the README should point to the canonical source.

**Content mapping**:
| README Section | Docs Target |
|---|---|
| Installation / Quick Install | `getting-started/installation.md` |
| Quick Start | `getting-started/quick-start.md` |
| Configuration Reference | `configuration/overview.md`, `configuration/profiles.md`, `configuration/dotfiles.md`, `configuration/install-blocks.md` |
| CLI Commands (validate, link, install) | `commands/validate.md`, `commands/link.md`, `commands/install.md` |
| Project Structure | `architecture/project-structure.md` |

### 7. Existing `/docs` Directory Conflict

**Decision**: The existing `docs/PRE-COMMIT-CHECKLIST.md` file must be relocated before Docusaurus docs content is added to `/docs`.

**Rationale**: Docusaurus will treat every `.md` file in the docs directory as a documentation page and include it in sidebar generation. `PRE-COMMIT-CHECKLIST.md` is an internal developer reference that should not appear on the public documentation site.

**Resolution**: Move `docs/PRE-COMMIT-CHECKLIST.md` to `.specify/memory/` or `design-notes/` (developer-facing content). Then the `/docs` directory is clear for documentation content.

### 8. Node.js Package Manager Choice

**Decision**: Use **npm** (not Yarn or pnpm) for the Docusaurus project.

**Rationale**: The existing CI workflow (`build.yml`) does not use any Node.js tooling, so there is no precedent to follow. npm is the default package manager that ships with Node.js, requires no additional installation, and is what Docusaurus's latest official deployment examples use. Using npm minimizes dependencies and cognitive overhead.

**Alternatives considered**:
- **Yarn**: Would require installing Yarn separately in CI. No advantage for this project.
- **pnpm**: Faster but less commonly seen in Docusaurus examples; would add unfamiliarity.

## Resolved Unknowns

All technical unknowns from the specification have been resolved through this research:

| Unknown | Resolution |
|---|---|
| External docs path configuration | Supported natively via `docs.path: '../docs'` |
| GitHub Pages deployment approach | Artifact-based deployment with `deploy-pages@v4` |
| Mermaid diagram rendering | `@docusaurus/theme-mermaid` with `markdown.mermaid: true` |
| Sidebar organization | Autogenerated with `_category_.json` overrides |
| Theming approach | Infima CSS variable overrides in `custom.css` |
| Existing `docs/` content conflict | Relocate `PRE-COMMIT-CHECKLIST.md` before adding docs content |
| Package manager | npm |
| Base URL for GitHub project pages | `/dottie/` (required for non-root GitHub Pages) |
